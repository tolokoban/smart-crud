{"intl":"","src":"require( 'tfw.web-service', function(exports, module) {  require(\"tfw.promise\");\nvar Storage = require(\"tfw.storage\");\nvar Listeners = require(\"tfw.listeners\");\n\nvar currentUser = null;\nvar changeEvent = new Listeners();\nvar config = {url: \"tfw\"};\nvar saved = Storage.local.get(\"nigolotua\");\nif (Array.isArray(saved)) {\n    config.usr = saved[0];\n    config.pwd = saved[1];\n}\n\nexports.BAD_ROLE = -1;\nexports.BAD_TYPE = -2;\nexports.CONNECTION_FAILURE = -3;\nexports.MISSING_AUTOLOGIN = -4;\nexports.UNKNOWN_USER = -5;\nexports.HTTP_ERROR = -6;\n\nfunction svc(name, args, url) {\n    console.info(\"[tfw.web-service]\", name, args);\n    return new Promise(\n        function(resolve, reject) {\n            if (typeof url === 'undefined') url = config.url;\n            var that = this;\n            var xhr = new XMLHttpRequest({mozSystem: true});\n            if ('withCredentials' in xhr) {\n                xhr.open(\"POST\", url + \"/svc.php\", true);\n                xhr.withCredentials = true;  // Indispensable pour le CORS.\n            } else {\n                // IE\n                xhr = new XDomainRequest();\n                xhr.open(\"POST\", url + \"/svc.php\");\n            }\n            xhr.onload = function() {\n                if (xhr.status != 200) {\n                    reject(\n                        {\n                            id: exports.HTTP_ERROR,\n                            msg: \"(\" + xhr.status + \") \" + xhr.statusText,\n                            status: xhr.status\n                        }\n                    );\n                }\n                var value = xhr.responseText;\n                if (typeof value === \"string\") {\n                    if (value.substr(0, 1) == \"!\") {\n                        reject(\n                            {\n                                id: exports.BAD_ROLE,\n                                msg: Error(\"Service \\\"\" + name + \"\\\" needs role \\\"\"\n                                           + value.substr(1) + \"\\\"!\")\n                            }\n                        );\n                    }\n                    var valueObject;\n                    try {\n                        valueObject = JSON.parse(value);\n                    }\n                    catch (ex) {\n                        reject(\n                            {\n                                id: exports.BAD_TYPE,\n                                msg: Error(\"Service \\\"\" + name\n                                           + \"\\\" should return a valid JSON!\\n\" + ex)\n                            }\n                        );\n                    }\n                    resolve(valueObject);\n                } else {\n                    reject(\n                        {\n                            id: exports.BAD_TYPE,\n                            msg: Error(\"Service \\\"\" + name + \"\\\" should return a string!\")\n                        }\n                    );\n                }\n            };\n            xhr.onerror = function() {\n                reject(\n                    {\n                        id: exports.HTTP_ERROR,\n                        msg: \"(\" + xhr.status + \") \" + xhr.statusText,\n                        status: xhr.status\n                    }\n                );\n            };\n            var params = \"s=\" + encodeURIComponent(name)\n                + \"&i=\" + encodeURIComponent(JSON.stringify(args));\n            xhr.setRequestHeader(\n                \"Content-type\",\n                \"application/x-www-form-urlencoded\");\n            xhr.send(params);\n        }\n    );\n}\n\n/**\n * Event fired when login status has changed.\n * @type {tfw.listeners}\n */\nexports.changeEvent = changeEvent;\n\n/**\n * Disconnect current user.\n * @return {Promise} A _thenable_ object resolved as soon as the server answered.\n */\nexports.logout = function() {\n    currentUser = null;\n    changeEvent.fire();\n    Storage.local.set(\"nigolotua\", null);\n    return svc(\"tfw.login.Logout\");\n};\n\n/**\n * Try to connect a user.\n * @param {string} usr Login name.\n * @param {string} pwd Password.\n * @return {Promise}\n *\n */\nexports.login = function(usr, pwd) {\n    if (typeof usr === 'undefined') usr = config.usr;\n    if (typeof pwd === 'undefined') pwd = config.pwd;\n\n    return new Promise(\n        function (resolve, reject) {\n            if (typeof usr === 'undefined') {\n                var autologin = Storage.local.get(\"nigolotua\");\n                if (!Array.isArray(autologin)) return reject({id: exports.MISSING_AUTOLOGIN});\n                usr = autologin[0];\n                pwd = autologin[1];\n            }\n            Storage.local.set(\"nigolotua\", null);\n            svc(\"tfw.login.Challenge\", usr)\n                .then(\n                    function(code) {\n                        // Hashage du mot de passe Ã  l'aide du code.\n                        var output = [0, 0, 0, 0,\n                                      0, 0, 0, 0,\n                                      0, 0, 0, 0,\n                                      0, 0, 0, 0],\n                        i, j = 0,\n                        pass = [],\n                        k1, k2, k3;\n                        for (i=0 ; i<pwd.length ; i++) {\n                            pass.push(pwd.charCodeAt(i));\n                        }\n                        if (256 % pass.length == 0) {\n                            pass.push(0);\n                        }\n\n                        for (i=0 ; i<256 ; i++) {\n                            output[i % 16] ^= i + pass[i % pass.length];\n                            k1 = code[j++ % code.length]%16;\n                            k2 = code[j++ % code.length]%16;\n                            k3 = code[j++ % code.length]%16;\n                            output[k3] ^= (output[k3] + 16*k2 + k3)%256;\n                            output[k2] ^= (output[k1] + output[k3])%256;\n                        }\n                        return svc(\"tfw.login.Response\", output); //.then(resolve, reject);\n                    },\n                    reject\n                )\n                .then(\n                    function(user) {\n                        if (typeof user === 'object') {\n                            currentUser = {\n                                data: user,\n                                hasRole: function(role) {\n                                    for (var i = 0 ; i < user.roles.length ; i++) {\n                                        var item = user.roles[i];\n                                        if (item == role) return true;\n                                    }\n                                    return false;\n                                }\n                            };\n                            Storage.local.set(\"nigolotua\", [usr, pwd]);\n                            changeEvent.fire();\n                            resolve(user);\n                        } else {\n                            currentUser = null;\n                            reject({id: exports.UNKNOWN_USER});\n                        }\n                    },\n                    reject\n                );\n        }\n    );\n};\n\n/**\n * Call a webservice.\n */\nexports.get = function(name, args, url) {\n    return new Promise(\n        function(resolve, reject) {\n            svc(name, args, url).then(\n                resolve,\n                function(err) {\n                    if (typeof err === 'object' && err.id == exports.BAD_ROLE) {\n                        // Echec de connexion, on retente de se connecter avant d'abandonner.\n                        exports.login().then(\n                            function() {\n                                svc(name, args, url).then(resolve, reject);\n                            },\n                            reject\n                        );\n                    } else {\n                        reject(err);\n                    }\n                }\n            );\n        }\n    );\n};\n\nexports.user = function() {\n    return currentUser;\n};\n\nexports.config = function(key, val) {\n    if (typeof val === 'undefined') {\n        return config[key];\n    }\n    config[key] = val;\n    return val;\n};\n\n// _Backward compatibility.\nif (window.$$) {\n    window.$$.service = function (name, args, caller, onSuccess, onError) {\n        var p = exports.get(name, args);\n        p.then(\n            function(value) {\n                if (onSuccess) {\n                    return caller[onSuccess].call(caller, value);\n                }\n                return value;\n            },\n            function(reason) {\n                if (onError) {\n                    return caller[onError].call(caller, reason);\n                }\n                return reason;\n            }\n        );\n    };\n}\n });\n","zip":"require(\"tfw.web-service\",function(e,n){function t(n,t,r){return console.info(\"[tfw.web-service]\",n,t),new Promise(function(o,i){\"undefined\"==typeof r&&(r=s.url);var u=new XMLHttpRequest({mozSystem:!0});\"withCredentials\"in u?(u.open(\"POST\",r+\"/svc.php\",!0),u.withCredentials=!0):(u=new XDomainRequest,u.open(\"POST\",r+\"/svc.php\")),u.onload=function(){200!=u.status&&i({id:e.HTTP_ERROR,msg:\"(\"+u.status+\") \"+u.statusText,status:u.status});var t=u.responseText;if(\"string\"==typeof t){\"!\"==t.substr(0,1)&&i({id:e.BAD_ROLE,msg:Error('Service \"'+n+'\" needs role \"'+t.substr(1)+'\"!')});var r;try{r=JSON.parse(t)}catch(s){i({id:e.BAD_TYPE,msg:Error('Service \"'+n+'\" should return a valid JSON!\\n'+s)})}o(r)}else i({id:e.BAD_TYPE,msg:Error('Service \"'+n+'\" should return a string!')})},u.onerror=function(){i({id:e.HTTP_ERROR,msg:\"(\"+u.status+\") \"+u.statusText,status:u.status})};var l=\"s=\"+encodeURIComponent(n)+\"&i=\"+encodeURIComponent(JSON.stringify(t));u.setRequestHeader(\"Content-type\",\"application/x-www-form-urlencoded\"),u.send(l)})}require(\"tfw.promise\");var r=require(\"tfw.storage\"),o=require(\"tfw.listeners\"),i=null,u=new o,s={url:\"tfw\"},l=r.local.get(\"nigolotua\");Array.isArray(l)&&(s.usr=l[0],s.pwd=l[1]),e.BAD_ROLE=-1,e.BAD_TYPE=-2,e.CONNECTION_FAILURE=-3,e.MISSING_AUTOLOGIN=-4,e.UNKNOWN_USER=-5,e.HTTP_ERROR=-6,e.changeEvent=u,e.logout=function(){return i=null,u.fire(),r.local.set(\"nigolotua\",null),t(\"tfw.login.Logout\")},e.login=function(n,o){return\"undefined\"==typeof n&&(n=s.usr),\"undefined\"==typeof o&&(o=s.pwd),new Promise(function(s,l){if(\"undefined\"==typeof n){var f=r.local.get(\"nigolotua\");if(!Array.isArray(f))return l({id:e.MISSING_AUTOLOGIN});n=f[0],o=f[1]}r.local.set(\"nigolotua\",null),t(\"tfw.login.Challenge\",n).then(function(e){var n,r,i,u,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=0,f=[];for(n=0;n<o.length;n++)f.push(o.charCodeAt(n));for(256%f.length==0&&f.push(0),n=0;256>n;n++)s[n%16]^=n+f[n%f.length],r=e[l++%e.length]%16,i=e[l++%e.length]%16,u=e[l++%e.length]%16,s[u]^=(s[u]+16*i+u)%256,s[i]^=(s[r]+s[u])%256;return t(\"tfw.login.Response\",s)},l).then(function(t){\"object\"==typeof t?(i={data:t,hasRole:function(e){for(var n=0;n<t.roles.length;n++){var r=t.roles[n];if(r==e)return!0}return!1}},r.local.set(\"nigolotua\",[n,o]),u.fire(),s(t)):(i=null,l({id:e.UNKNOWN_USER}))},l)})},e.get=function(n,r,o){return new Promise(function(i,u){t(n,r,o).then(i,function(s){\"object\"==typeof s&&s.id==e.BAD_ROLE?e.login().then(function(){t(n,r,o).then(i,u)},u):u(s)})})},e.user=function(){return i},e.config=function(e,n){return\"undefined\"==typeof n?s[e]:(s[e]=n,n)},window.$$&&(window.$$.service=function(n,t,r,o,i){var u=e.get(n,t);u.then(function(e){return o?r[o].call(r,e):e},function(e){return i?r[i].call(r,e):e})})});\n//# sourceMappingURL=tfw.web-service.js.map","map":{"version":3,"file":"tfw.web-service.js.map","sources":["tfw.web-service.js"],"sourcesContent":["require( 'tfw.web-service', function(exports, module) {  require(\"tfw.promise\");\nvar Storage = require(\"tfw.storage\");\nvar Listeners = require(\"tfw.listeners\");\n\nvar currentUser = null;\nvar changeEvent = new Listeners();\nvar config = {url: \"tfw\"};\nvar saved = Storage.local.get(\"nigolotua\");\nif (Array.isArray(saved)) {\n    config.usr = saved[0];\n    config.pwd = saved[1];\n}\n\nexports.BAD_ROLE = -1;\nexports.BAD_TYPE = -2;\nexports.CONNECTION_FAILURE = -3;\nexports.MISSING_AUTOLOGIN = -4;\nexports.UNKNOWN_USER = -5;\nexports.HTTP_ERROR = -6;\n\nfunction svc(name, args, url) {\n    console.info(\"[tfw.web-service]\", name, args);\n    return new Promise(\n        function(resolve, reject) {\n            if (typeof url === 'undefined') url = config.url;\n            var that = this;\n            var xhr = new XMLHttpRequest({mozSystem: true});\n            if ('withCredentials' in xhr) {\n                xhr.open(\"POST\", url + \"/svc.php\", true);\n                xhr.withCredentials = true;  // Indispensable pour le CORS.\n            } else {\n                // IE\n                xhr = new XDomainRequest();\n                xhr.open(\"POST\", url + \"/svc.php\");\n            }\n            xhr.onload = function() {\n                if (xhr.status != 200) {\n                    reject(\n                        {\n                            id: exports.HTTP_ERROR,\n                            msg: \"(\" + xhr.status + \") \" + xhr.statusText,\n                            status: xhr.status\n                        }\n                    );\n                }\n                var value = xhr.responseText;\n                if (typeof value === \"string\") {\n                    if (value.substr(0, 1) == \"!\") {\n                        reject(\n                            {\n                                id: exports.BAD_ROLE,\n                                msg: Error(\"Service \\\"\" + name + \"\\\" needs role \\\"\"\n                                           + value.substr(1) + \"\\\"!\")\n                            }\n                        );\n                    }\n                    var valueObject;\n                    try {\n                        valueObject = JSON.parse(value);\n                    }\n                    catch (ex) {\n                        reject(\n                            {\n                                id: exports.BAD_TYPE,\n                                msg: Error(\"Service \\\"\" + name\n                                           + \"\\\" should return a valid JSON!\\n\" + ex)\n                            }\n                        );\n                    }\n                    resolve(valueObject);\n                } else {\n                    reject(\n                        {\n                            id: exports.BAD_TYPE,\n                            msg: Error(\"Service \\\"\" + name + \"\\\" should return a string!\")\n                        }\n                    );\n                }\n            };\n            xhr.onerror = function() {\n                reject(\n                    {\n                        id: exports.HTTP_ERROR,\n                        msg: \"(\" + xhr.status + \") \" + xhr.statusText,\n                        status: xhr.status\n                    }\n                );\n            };\n            var params = \"s=\" + encodeURIComponent(name)\n                + \"&i=\" + encodeURIComponent(JSON.stringify(args));\n            xhr.setRequestHeader(\n                \"Content-type\",\n                \"application/x-www-form-urlencoded\");\n            xhr.send(params);\n        }\n    );\n}\n\n/**\n * Event fired when login status has changed.\n * @type {tfw.listeners}\n */\nexports.changeEvent = changeEvent;\n\n/**\n * Disconnect current user.\n * @return {Promise} A _thenable_ object resolved as soon as the server answered.\n */\nexports.logout = function() {\n    currentUser = null;\n    changeEvent.fire();\n    Storage.local.set(\"nigolotua\", null);\n    return svc(\"tfw.login.Logout\");\n};\n\n/**\n * Try to connect a user.\n * @param {string} usr Login name.\n * @param {string} pwd Password.\n * @return {Promise}\n *\n */\nexports.login = function(usr, pwd) {\n    if (typeof usr === 'undefined') usr = config.usr;\n    if (typeof pwd === 'undefined') pwd = config.pwd;\n\n    return new Promise(\n        function (resolve, reject) {\n            if (typeof usr === 'undefined') {\n                var autologin = Storage.local.get(\"nigolotua\");\n                if (!Array.isArray(autologin)) return reject({id: exports.MISSING_AUTOLOGIN});\n                usr = autologin[0];\n                pwd = autologin[1];\n            }\n            Storage.local.set(\"nigolotua\", null);\n            svc(\"tfw.login.Challenge\", usr)\n                .then(\n                    function(code) {\n                        // Hashage du mot de passe Ã  l'aide du code.\n                        var output = [0, 0, 0, 0,\n                                      0, 0, 0, 0,\n                                      0, 0, 0, 0,\n                                      0, 0, 0, 0],\n                        i, j = 0,\n                        pass = [],\n                        k1, k2, k3;\n                        for (i=0 ; i<pwd.length ; i++) {\n                            pass.push(pwd.charCodeAt(i));\n                        }\n                        if (256 % pass.length == 0) {\n                            pass.push(0);\n                        }\n\n                        for (i=0 ; i<256 ; i++) {\n                            output[i % 16] ^= i + pass[i % pass.length];\n                            k1 = code[j++ % code.length]%16;\n                            k2 = code[j++ % code.length]%16;\n                            k3 = code[j++ % code.length]%16;\n                            output[k3] ^= (output[k3] + 16*k2 + k3)%256;\n                            output[k2] ^= (output[k1] + output[k3])%256;\n                        }\n                        return svc(\"tfw.login.Response\", output); //.then(resolve, reject);\n                    },\n                    reject\n                )\n                .then(\n                    function(user) {\n                        if (typeof user === 'object') {\n                            currentUser = {\n                                data: user,\n                                hasRole: function(role) {\n                                    for (var i = 0 ; i < user.roles.length ; i++) {\n                                        var item = user.roles[i];\n                                        if (item == role) return true;\n                                    }\n                                    return false;\n                                }\n                            };\n                            Storage.local.set(\"nigolotua\", [usr, pwd]);\n                            changeEvent.fire();\n                            resolve(user);\n                        } else {\n                            currentUser = null;\n                            reject({id: exports.UNKNOWN_USER});\n                        }\n                    },\n                    reject\n                );\n        }\n    );\n};\n\n/**\n * Call a webservice.\n */\nexports.get = function(name, args, url) {\n    return new Promise(\n        function(resolve, reject) {\n            svc(name, args, url).then(\n                resolve,\n                function(err) {\n                    if (typeof err === 'object' && err.id == exports.BAD_ROLE) {\n                        // Echec de connexion, on retente de se connecter avant d'abandonner.\n                        exports.login().then(\n                            function() {\n                                svc(name, args, url).then(resolve, reject);\n                            },\n                            reject\n                        );\n                    } else {\n                        reject(err);\n                    }\n                }\n            );\n        }\n    );\n};\n\nexports.user = function() {\n    return currentUser;\n};\n\nexports.config = function(key, val) {\n    if (typeof val === 'undefined') {\n        return config[key];\n    }\n    config[key] = val;\n    return val;\n};\n\n// _Backward compatibility.\nif (window.$$) {\n    window.$$.service = function (name, args, caller, onSuccess, onError) {\n        var p = exports.get(name, args);\n        p.then(\n            function(value) {\n                if (onSuccess) {\n                    return caller[onSuccess].call(caller, value);\n                }\n                return value;\n            },\n            function(reason) {\n                if (onError) {\n                    return caller[onError].call(caller, reason);\n                }\n                return reason;\n            }\n        );\n    };\n}\n });\n"],"names":["require","exports","module","svc","name","args","url","console","info","Promise","resolve","reject","config","xhr","XMLHttpRequest","mozSystem","open","withCredentials","XDomainRequest","onload","status","id","HTTP_ERROR","msg","statusText","value","responseText","substr","BAD_ROLE","Error","valueObject","JSON","parse","ex","BAD_TYPE","onerror","params","encodeURIComponent","stringify","setRequestHeader","send","Storage","Listeners","currentUser","changeEvent","saved","local","get","Array","isArray","usr","pwd","CONNECTION_FAILURE","MISSING_AUTOLOGIN","UNKNOWN_USER","logout","fire","set","login","autologin","then","code","i","k1","k2","k3","output","j","pass","length","push","charCodeAt","user","data","hasRole","role","roles","item","err","key","val","window","$$","service","caller","onSuccess","onError","p","call","reason"],"mappings":"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"},"dependencies":["mod/tfw.web-service","mod/tfw.promise","mod/tfw.storage","mod/tfw.listeners"]}